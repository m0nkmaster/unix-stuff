#!/bin/sh 
#
# Reithproxies script = sets up my mac for working ON or OFF Reith

# Always use my .bashrc 
. ~/.bashrc

# Prepare the ground work
networkLocation=$(networksetup -getcurrentlocation)
stateFile=".onoffreith"
touch ~/"$stateFile"
currentState=`less ~/$stateFile`
changeProxies=false

# ON NETWORK SETTINGS
if [[ "$networkLocation" = "BBC On Network" && "$currentState" != "on" ]]
then
    echo "BBC On Network"
    `echo "on" > ~/$stateFile`
    changeProxies=true
    localeName=work
    . ~/.reithproxies
fi

# OFF NETWORK SETTINGS
if [[ "$networkLocation" = "BBC Off Network" && "$currentState" != "off" ]]
then
    echo "BBC Off Network"
    `echo "off" > ~/$stateFile`
    changeProxies=true
    localeName=home
    . ~/.removeproxies
fi

if [ $changeProxies == true ]
then 
    # Stop stunnel
    killall stunnel

    echo "Changing SVN settings"
    ln -sf /Volumes/SecureDrive/subversion/servers.$localeName /Volumes/SecureDrive/subversion/servers

    echo "Changing Stunnel settings"
    ln -sf /Volumes/SecureDrive/stunnel/stunnel-$localeName.conf /Volumes/SecureDrive/stunnel/stunnel.conf
    stunnel
fi